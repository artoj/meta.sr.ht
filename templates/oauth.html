{% extends "meta.html" %}
{% block content %}
<div class="row">
  <section class="col-md-12">
    <h3>Authorized Clients</h3>
    {% if any(client_authorizations) %}
    <p>The following third party clients have access to your account:</p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Owner</th>
          <th>First Authorized</th>
          <th>Last Used</th>
          <th>Expires</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for token in client_authorizations %}
        <tr>
          <td>{{ token.client.client_name }}</td>
          <td>{{ token.client.user.username }}</td>
          <td>{{ datef(token.created) }}</td>
          <td>{{ datef(token.updated) }}</td>
          <td>{{ datef(token.expires) }}</td>
          <td><a href="/oauth/revoke-token/{{ token.id }}">Revoke</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>You have not granted any third party clients access to your account.</p>
    {% endif %}
  </section>
  <section class="col-md-12">
    <h3>Registered Clients</h3>
    {% if any(user.oauth_clients) %}
    <p>You have registered the following OAuth clients:</p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Client ID</th>
          <th>Active users</th>
          <th colspan="3"></th>
        </tr>
      </thead>
      <tbody>
        {% for client in user.oauth_clients %}
        <tr>
          <td>{{ client.client_name }}</td>
          <td>{{ client.client_id }}</td>
          <td>{{ client_tokens(client) }}</td>
          <td>
            <form action="/oauth/reset-secret/{{ client.client_id }}" method="POST">
              <button class="btn btn-link">Reset client secret</button>
            </form>
          </td>
          <td>
            <a href="/oauth/revoke-tokens/{{client.client_id}}">Revoke all tokens</a>
          </td>
          <td>
            <a href="/oauth/delete-client/{{client.client_id}}">Delete client</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>You have not registered any OAuth clients yet.</p>
    {% endif %}
    <a class="btn btn-default" href="/oauth/register">Register new client</a>
  </section>
  <section class="col-md-12">
    <h3>Personal Access Tokens</h3>
    <p>You have obtained the following personal access tokens:</p>
    <table>
      <thead>
        <tr>
          <th>Access token</th>
          <th>Date issued</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>16efca3...</td>
          <td>2016-10-14 01:23:48</td>
          <td><a href="/oauth/revoke/:id">Revoke</a></td>
        </tr>
      </tbody>
    </table>
    <a class="btn btn-default" href="/oauth/personal-token">Generate new token</a>
  </section>
</div>
{% endblock %}
